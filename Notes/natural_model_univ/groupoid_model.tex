% \subsection{Overview}

In this section we construct a natural model in $\Pshgrpd$ the presheaf category
indexed by the category $\grpd$ of (small) groupoids.
We will build the classifier for display maps in the style of
Hofmann and Streicher \cite{hofmannstreicher1996} and Awodey \cite{awodey2023hofmannstreicheruniverses}.
To interpret the type constructors,
we will make use of the weak factorization system on $\grpd$ -
which comes from restricting the ``classical Quillen model structure'' on
$\cat$ \cite{joyalnlabmodelstructuresoncat} to $\grpd$.

\medskip

\begin{notation*}
  We will have two universe sizes - one small and one large.
  We denote the category of small sets as $\set$ and the large sets as $\Set$
  (in the previous sections this would have been $\Set_{\lambda}$ and $\Set$ respectively).
  We denote the category of small categories as $\cat$ and the large categories as $\Cat$.
  We denote the category of small groupoids as $\grpd$. %% and the large groupoids as $\GRPD$.
  The category of small pointed groupoids will be $\grpd_{\bullet}$.

  We are primarily working in the category of large presheaves indexed by small groupoids,
  which we will denote by
  \[ \Pshgrpd = [\grpd^{\op}, \Set]\]

  In this section, $\Term$ and $\Type$ and so on will refer to the natural model semantics in this
  specific model.
\end{notation*}

\medskip

\begin{defn}[The disply map classifier]
  We would like to define a natural transformation in
  $\Pshgrpd$
  \[ \tp \co \Term \to \Type \]
  with representable fibers.

  Consider the functor that forgets the point
  \[
    U \co \ptgrpd \to \grpd
    \quad \quad
    \text{
      in \quad $\Cat$.
    }
  \]
  If we apply the Yoneda embedding $\yo \co \Cat \to \PshCat$ to $U$
  we obtain
  \[ U \circ \co [ - , \ptgrpd] \to [ - , \grpd ]
    \quad \quad
    \text{
      in \quad $\PshCat$.
    }
  \]
  Since any small groupoid is also a large category $\grpd \hookrightarrow \Cat$,
  we can restrict $\Cat$ indexed presheaves to be $\grpd$ indexed presheaves.
  We define $\tp \co \Term \to \Type$ as the image of $U \circ$ under this restriction.
  % https://q.uiver.app/#q=WzAsNixbMCwwLCJcXENhdCJdLFsxLDAsIlxcUHNoQ2F0Il0sWzIsMCwiXFxQc2hncnBkIl0sWzAsMSwiXFxncnBkIl0sWzEsMSwiWy0sXFxncnBkXSJdLFsyLDEsIlxcVHlwZSJdLFswLDEsInkiXSxbMSwyLCJcXHRleHRzZntyZXN9Il0sWzMsNCwiIiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibWFwcyB0byJ9fX1dLFs0LDUsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1hcHMgdG8ifX19XV0=
  \[\begin{tikzcd}[row sep = tiny]
    \Cat & \PshCat & \Pshgrpd \\
    \grpd & {[-,\grpd]} & \Type
    \arrow["\yo", from=1-1, to=1-2]
    \arrow["{\textsf{res}}", from=1-2, to=1-3]
    \arrow[maps to, from=2-1, to=2-2]
    \arrow[maps to, from=2-2, to=2-3]
  \end{tikzcd}\]
  Note that $\Term$ and $\Type$ are not representable in $\Pshgrpd$.
\end{defn}

\medskip

\begin{rmk}
  By Yoneda we can identify maps with representable domain into the
  type classifier
  \[ A : \yo \Ga \to \Type \quad \quad \text{ in } \quad \Pshgrpd \]
  with functors
  \[ A : \Ga \to \grpd \quad \quad \text{ in } \quad \Cat \]

\end{rmk}

\medskip

\begin{defn}[Grothendieck construction]
  From $\catC$ a small category and $F : \catC \to \Cat$
  a functor, we construct a small category $\int F$.
  For any $c$ in $\catC$ we refer to $F c$ as the fiber over $c$.
  The objects of $\int F$ consist of pairs $(c \in \catC, x \in F c)$,
  and morphisms are those in $\catC$ preserving the points in the fiber.
  This makes the following pullback
  % https://q.uiver.app/#q=WzAsMTEsWzEsMSwiXFxpbnQgRiJdLFsxLDIsIlxcY2F0QyJdLFsyLDEsIlxccHRDYXQiXSxbMiwyLCJcXENhdCJdLFswLDEsIihjLHgpIl0sWzAsMiwiYyJdLFsxLDAsIihjLHgpIl0sWzIsMCwiKEZjLCB4KSJdLFsxLDNdLFszLDEsIihDLGMpIl0sWzMsMiwiQyJdLFswLDFdLFswLDJdLFsyLDNdLFsxLDMsIkYiLDJdLFs0LDUsIiIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1hcHMgdG8ifX19XSxbNiw3LCIiLDIseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtYXBzIHRvIn19fV0sWzAsMywiIiwyLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV0sWzksMTAsIiIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Im1hcHMgdG8ifX19XV0=
  \[\begin{tikzcd}
    & {(c,x)} & {(Fc, x)} \\
    {(c,x)} & {\int F} & \ptCat & {(C,c)} \\
    c & \catC & \Cat & C \\
    & {}
    \arrow[maps to, from=1-2, to=1-3]
    \arrow[maps to, from=2-1, to=3-1]
    \arrow[from=2-2, to=2-3]
    \arrow[from=2-2, to=3-2]
    \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=2-2, to=3-3]
    \arrow[from=2-3, to=3-3]
    \arrow[maps to, from=2-4, to=3-4]
    \arrow["F"', from=3-2, to=3-3]
  \end{tikzcd}\]
  where $\ptCat$ is the category of large pointed categories.
\end{defn}

\medskip

\begin{defn}[Grothendieck construction for groupoids]
  Let $\Ga$ be a groupoid and $A \co \Ga \to \grpd$ a functor,
  we can compose $F$ with the inclusion $i \co \grpd \hookrightarrow \Cat$
  and form the Grothendieck construction which we denote as
  \[ \Ga \cdot A := \int i \circ A \quad \quad \disp{A} \co \Ga \cdot A \to \Ga\]
  This is also a small groupoid since the underlying morphisms are
  from the groupoid $\Ga$.
  Furthermore the pullback factors through (pointed) groupoids.
  % https://q.uiver.app/#q=WzAsNyxbMCwwLCJcXEdhIFxcY2RvdCBBIl0sWzAsMSwiXFxHYSJdLFsxLDAsIlxccHRncnBkIl0sWzEsMSwiXFxncnBkIl0sWzAsMl0sWzIsMCwiXFxwdENhdCJdLFsyLDEsIlxcQ2F0Il0sWzAsMV0sWzAsMl0sWzIsM10sWzEsMywiQSIsMl0sWzAsMywiIiwyLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV0sWzIsNV0sWzMsNl0sWzUsNl0sWzIsNiwiIiwxLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d
  \[\begin{tikzcd}
    {\Ga \cdot A} & \ptgrpd & \ptCat \\
    \Ga & \grpd & \Cat \\
    {}
    \arrow[from=1-1, to=1-2]
    \arrow[from=1-1, to=2-1]
    \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
    \arrow[from=1-2, to=1-3]
    \arrow[from=1-2, to=2-2]
    \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-2, to=2-3]
    \arrow[from=1-3, to=2-3]
    \arrow["A"', from=2-1, to=2-2]
    \arrow[from=2-2, to=2-3]
  \end{tikzcd}\]
\end{defn}

\medskip

\begin{cor}[The display map classifier is presentable]
  For any small groupoid $\Ga$ and $A : \yo \Ga \to \Type$,
  the pullback of $\tp$ along $A$ can be given by the representable
  map $\yo \disp{A}$.
  % https://q.uiver.app/#q=WzAsNSxbMCwwLCJcXHlvIFxcR2EgXFxjZG90IEEiXSxbMCwxLCJcXHlvIFxcR2EiXSxbMSwwLCJcXFRlcm0iXSxbMSwxLCJcXFR5cGUiXSxbMCwyXSxbMCwxLCJcXGRpc3AgQSIsMl0sWzAsMl0sWzIsMywiXFx0cCIsMl0sWzEsMywiQSIsMl0sWzAsMywiIiwyLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d
  \[\begin{tikzcd}
    {\yo \Ga \cdot A} & \Term \\
    {\yo \Ga} & \Type \\
    {}
    \arrow[from=1-1, to=1-2]
    \arrow["{\disp A}"', from=1-1, to=2-1]
    \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
    \arrow["\tp"', from=1-2, to=2-2]
    \arrow["A"', from=2-1, to=2-2]
  \end{tikzcd}\]
\end{cor}
\begin{proof}
  Consider the pullback in $\Cat$
  % https://q.uiver.app/#q=WzAsNSxbMCwwLCJcXEdhIFxcY2RvdCBBIl0sWzAsMSwiXFxHYSJdLFsxLDAsIlxccHRncnBkIl0sWzEsMSwiXFxncnBkIl0sWzAsMl0sWzAsMV0sWzAsMl0sWzIsM10sWzEsMywiQSIsMl0sWzAsMywiIiwyLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d
  \[\begin{tikzcd}
    {\Ga \cdot A} & \ptgrpd \\
    \Ga & \grpd \\
    {}
    \arrow[from=1-1, to=1-2]
    \arrow[from=1-1, to=2-1]
    \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
    \arrow[from=1-2, to=2-2]
    \arrow["A"', from=2-1, to=2-2]
  \end{tikzcd}\]
  We send this square along $\textsf{res} \circ \yo$ in the following
  % https://q.uiver.app/#q=WzAsNSxbMiwxLCJcXFBzaGdycGQiXSxbMSwyXSxbMiwwLCJcXFBzaENhdCJdLFswLDAsIlxcQ2F0Il0sWzAsMSwiXFxncnBkIl0sWzMsMiwiXFx5byJdLFsyLDAsIlxcdGV4dHNme3Jlc30iXSxbMywwXSxbNCwzXSxbNCwwLCJcXHlvIl1d
  \[\begin{tikzcd}
    \Cat && \PshCat \\
    \grpd && \Pshgrpd \\
    & {}
    \arrow["\yo", from=1-1, to=1-3]
    \arrow[from=1-1, to=2-3]
    \arrow["{\textsf{res}}", from=1-3, to=2-3]
    \arrow[from=2-1, to=1-1]
    \arrow["\yo", from=2-1, to=2-3]
  \end{tikzcd}\]
  The Yoneda embedding $\yo : \Cat \to \PshCat$ preserves pullbacks,
  as does $\textsf{res}$,
  since it is a right adjoint
  (with left Kan extension $\io_{!} \dashv \textsf{res}_{\io}$).
\end{proof}
